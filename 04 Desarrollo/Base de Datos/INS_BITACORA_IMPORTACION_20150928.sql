--  Generate SQL --  Version:                   	V5R4M0 060210 --  Generated on:              	28/09/15 20:19:40 --  Relational Database:       	B103BE2F --  Standards Option:          	DB2 UDB iSeries   SET PATH "QSYS","QSYS2","QGPL","CARVALHORA" ;   CREATE PROCEDURE CARVALHORA.INS_BITACORA_IMPORTACION ( 	IN P_ID_LAYOUT INTEGER , 	IN P_USER VARCHAR(15) , 	IN P_ARCHIVO VARCHAR(255) , 	IN P_EXTENSION VARCHAR(5) , 	IN P_OBS VARCHAR(255) ) 	DYNAMIC RESULT SETS 1 	LANGUAGE SQL 	SPECIFIC CARVALHORA.INS_BITACORA_IMPORTACION 	NOT DETERMINISTIC 	MODIFIES SQL DATA 	CALLED ON NULL INPUT 	SET OPTION  ALWBLK = *ALLREAD , 	ALWCPYDTA = *OPTIMIZE , 	COMMIT = *NONE , 	DECRESULT = (31, 31, 00) , 	DFTRDBCOL = *NONE , 	DYNDFTCOL = *NO , 	DYNUSRPRF = *USER , 	SRTSEQ = *HEX   	P1 : BEGIN   		DECLARE V_ID_BIIM BIGINT ; 		DECLARE V_COUNT_REG BIGINT ;   		 -- Devuelve registro que se dio de alta 		DECLARE C1 CURSOR WITH RETURN FOR 			 			SELECT * 			FROM CARVALHORA . TRA_BIIM 			WHERE BII_CVE = V_ID_BIIM ;     		 -- Obtiene registros existentes en la Bit치cora de Importaci칩n 		SELECT COUNT ( * ) INTO V_COUNT_REG FROM CARVALHORA . TRA_BIIM ;   		 -- Obtiene ID consecutivo de la Bit치cora de Importaci칩n 		IF V_COUNT_REG = 0 THEN 			SET V_ID_BIIM = 1 ; 		ELSE 			SELECT MAX ( BII_CVE ) + 1 INTO V_ID_BIIM FROM CARVALHORA . TRA_BIIM ; 		END IF ;   		 -- Registra 		INSERT INTO CARVALHORA . TRA_BIIM VALUES ( 					V_ID_BIIM , 					1 , 					P_ID_LAYOUT , 					P_USER , 					P_ARCHIVO , 					P_EXTENSION , 					CURRENT DATE , 					CURRENT TIME , 					NULL , 					NULL , 					0 , 					0 , 					0 , 					0 , 					CASE WHEN P_OBS = '' THEN NULL ELSE P_OBS END 				) ;   		OPEN C1 ;   	END P1  ;